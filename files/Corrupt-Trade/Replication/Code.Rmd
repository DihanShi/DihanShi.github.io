---
title: Replication Code for "‘If Foreign, then Cleaner’ Individual Corruption Perceptions
  and Support for Free Trade in Developing Nations"
author: "Dihan Shi, Guillermo Rosas | Washington University in St. Louis"
date: "March 2024"
output:
  html_document:
    toc: true
    toc_depth: '4'
    df_print: paged
---

```{r setup, include=FALSE}
if (!requireNamespace("remotes", quietly = TRUE)) {
  install.packages("remotes")
}

remotes::install_version("renv", version = "1.0.5")
renv::restore()

# If prompted, press `Y` and then `enter` or `return` in the Console to proceed
# Delete the code above if you do not wish to install the `renv` package and restore the project environment

knitr::opts_chunk$set(comment = "|", fig.align = "left")

library(rmarkdown)
library(readr)
library(dplyr)
library(factoextra)
library(mediation)
library(effects)
library(scales)
library(ggplot2)
library(ggeffects)
library(ggridges)
library(patchwork)
library(stargazer)
```


## Analyses using Latinobarometro 2020 data

### Data preparation

```{r}
rm(list = ls())

data <- readRDS("Data/Latinobarometro_2020_Eng_Rds_v1_0.rds")

data$presidente <- ifelse(data$P71STM_01 >= 0, data$P71STM_01, NA)
data$parlamentarios <- ifelse(data$P71STM_02 >= 0, data$P71STM_02, NA)
data$empleadospublicos <- ifelse(data$P71STM_03 >= 0, data$P71STM_03, NA)
data$gobiernolocal <- ifelse(data$P71STM_04 >= 0, data$P71STM_04, NA)
data$jueces <- ifelse(data$P71STM_07 >= 0, data$P71STM_07, NA)

selected <- na.omit(dplyr::select(data, numentre, presidente, parlamentarios,
                                  empleadospublicos, gobiernolocal, jueces))

pca <- prcomp(selected[, c("presidente", "parlamentarios", "empleadospublicos",
                           "gobiernolocal", "jueces")])

PC1 <- -pca$x[, 1]
selected <- data.frame(selected, PC1)

data <- left_join(data, selected, by = c("numentre", "presidente", 
                                         "parlamentarios", "empleadospublicos",
                                         "gobiernolocal", "jueces"))

data$tradebenefit <- ifelse(data$p29st_b > 0, 4 - data$p29st_b, NA)
data$supportint <- ifelse(data$p26n_b > 0, 4 - data$p26n_b, NA)
data$protradeus <- ifelse(data$p32na > 0, 4 - data$p32na, NA)

data$usposinf <- ifelse(data$p35n_a > 0, 2 - data$p35n_a, NA)
data$trustforeigncomp <- ifelse(data$p15st_b > 0 & data$p15st_e > 0, 
                                data$p15st_b - data$p15st_e + 3, NA)
data$foreignprodqual <- ifelse(data$p29st_c > 0, data$p29st_c - 1, NA)

data$education <- NA
data$education[data$reeduc_1 %in% c(1, 2)] <- 0
data$education[data$reeduc_1 %in% c(3, 4)] <- 1
data$education[data$reeduc_1 %in% c(5, 6)] <- 2
data$education[data$reeduc_1 == 7] <- 3

data$employment <- data$s24_a - 1
data$employment <- as.factor(ifelse(data$employment > 2, 3, data$employment))
data$poorrich <- ifelse(data$p8st_a > 0, data$p8st_a - 1, NA)
data$poliscale <- ifelse(data$p18st >= 0 & data$p18st < 97, data$p18st, NA)
data$citizenship <- ifelse(data$s21 > 0, data$s21 - 1, NA)

data$idenpa <- as.factor(data$idenpa)

data$noprogress <- ifelse(data$p2st > 0, data$p2st - 1, NA)

data$eradicate <- ifelse(data$p20st_e > 0, 4 - data$p20st_e, NA)
data$eradicateimp <- ifelse(data$eradicate < 2, 1, 0)

data$dissatdem <- ifelse(data$P11STGBS_A > 0, data$P11STGBS_A - 1, NA)
data$dissatecon <- ifelse(data$P11STGBS_B > 0, data$P11STGBS_B - 1, NA)

data$distrustfb <- ifelse(data$p15n_h > 0, data$p15n_h - 1, NA)

data$cps <- data$presidente + data$parlamentarios + data$empleadospublicos +
  data$gobiernolocal + data$jueces

data$nacional <- ifelse(data$presidente == 1 & data$parlamentarios == 1, 1, 0)
data$sinacionalsilocal <- ifelse(data$nacional == 1 & data$gobiernolocal == 1, 1, 0)
data$sinacionalnolocal <- ifelse(data$nacional == 1 & data$gobiernolocal == 0, 1, 0)
data$nonacionalsilocal <- ifelse(data$nacional == 0 & data$gobiernolocal == 1, 1, 0)
data$nonacionalnolocal <- ifelse(data$nacional == 0 & data$gobiernolocal == 0, 1, 0)
```

### Results in main text

#### Figure 1. Predicted trade support conditional on corruption perceptions (with 95% confidence envelope)

```{r, warning=F}
fit_linear <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + 
                   poorrich + poliscale + citizenship + idenpa, data = data)

new_data <- data.frame(
  PC1 = seq(min(data$PC1, na.rm = TRUE), max(data$PC1, na.rm = TRUE), length.out=100),
  sexo = median(data$sexo, na.rm = TRUE),
  edad = median(data$edad, na.rm = TRUE),
  education = median(data$education, na.rm = TRUE),
  employment = as.factor(0),
  poorrich = median(data$poorrich, na.rm = TRUE),
  poliscale = median(data$poliscale, na.rm = TRUE),
  citizenship = median(data$citizenship, na.rm = TRUE),
  idenpa = as.factor(32)
)

pred_probs <- ggeffect(fit_linear, terms = "PC1", type = "response", 
                       data = new_data, ci_level = 0.95)

pred_probs_df <- as.data.frame(pred_probs)

ggplot() +
  geom_rug(data = data.frame(PC1 = jitter(data$PC1, factor = 2)), aes(x = PC1), 
           sides = "b", size = 0.01) + 
  geom_line(data = pred_probs_df, aes(x = x, y = predicted)) +
  geom_ribbon(data = pred_probs_df, aes(x = x, ymin = conf.low, ymax = conf.high), 
              alpha = 0.2) +
  xlab('Corruption Perceptions (PC1)') +
  ylab('Predicted Support for Free Trade') +
  ggtitle('Trade support is predicted to be greater at higher levels of perceived corruption') +
  theme_classic() +
  scale_y_continuous(breaks = seq(1.775, 1.975, by = 0.025), labels = label_number()) + 
  scale_x_continuous(breaks = seq(-1.2, 1.2, by = 0.3), labels = label_number())
```

#### Figure 2. Model-based causal mediation analysis results (with 95% confidence intervals)

```{r}
# This chunk typically takes a few minutes to run

set.seed(12345)

opar <- par(no.readonly = TRUE)

par(mfrow = c(2, 2))


selected <- na.omit(dplyr::select(data, tradebenefit, PC1, usposinf, sexo, edad,
                                  education, employment, poorrich, poliscale, 
                                  citizenship, idenpa))

mediator_model <- lm(usposinf ~ PC1 + sexo + edad + education + employment + 
                       poorrich + poliscale + citizenship + idenpa, selected)

outcome_model <- lm(tradebenefit ~ PC1 + usposinf + sexo + edad + education + 
                      employment + poorrich + poliscale + citizenship + idenpa, 
                    selected)

mediation_result <- mediate(mediator_model, outcome_model, treat = 'PC1', 
                            mediator = 'usposinf')

summary(mediation_result)

par(mar=c(5.1, 4.1, 3.1, 2.1))

plot(mediation_result, main = "Foreign nations", 
     xlab = "Effects on (General) Trade Support")
mtext("(Prop. Mediated = 0.16)", side = 3, line = 0.1, cex = 0.75)


selected <- na.omit(dplyr::select(data, protradeus, PC1, usposinf, sexo, edad, 
                                  education, employment, poorrich, poliscale, 
                                  citizenship, idenpa))

mediator_model <- lm(usposinf ~ PC1 + sexo + edad + education + employment + 
                       poorrich + poliscale + citizenship + idenpa, selected)

outcome_model <- lm(protradeus ~ PC1 + usposinf + sexo + edad + education + 
                      employment + poorrich + poliscale + citizenship + idenpa, 
                    selected)

mediation_result <- mediate(mediator_model, outcome_model, treat = 'PC1', 
                            mediator = 'usposinf')

summary(mediation_result)

par(mar=c(5.1, 4.1, 3.1, 2.1))

plot(mediation_result, main = "Foreign nations", 
     xlab = "Effects on Support for Trade with the US")
mtext("(Prop. Mediated = 0.32)", side = 3, line = 0.1, cex = 0.75)


selected <- na.omit(dplyr::select(data, tradebenefit, PC1, trustforeigncomp, 
                                  sexo, edad, education, employment, poorrich, 
                                  poliscale, citizenship, idenpa))

mediator_model <- lm(trustforeigncomp ~ PC1 + sexo + edad + education + 
                       employment + poorrich + poliscale + citizenship + idenpa, 
                     selected)

outcome_model <- lm(tradebenefit ~ PC1 + trustforeigncomp + sexo + edad + 
                      education + employment + poorrich + poliscale + 
                      citizenship + idenpa, selected)

mediation_result <- mediate(mediator_model, outcome_model, treat = 'PC1', 
                            mediator = 'trustforeigncomp')

summary(mediation_result)

par(mar=c(5.1, 4.1, 3.1, 2.1))

plot(mediation_result, main = "International companies", 
     xlab = "Effects on (General) Trade Support")
mtext("(Prop. Mediated = 0.04)", side = 3, line = 0.1, cex = 0.75)


selected <- na.omit(dplyr::select(data, tradebenefit, PC1, foreignprodqual, 
                                  sexo, edad, education, employment, poorrich, 
                                  poliscale, citizenship, idenpa))

mediator_model <- lm(foreignprodqual ~ PC1 + sexo + edad + education + 
                       employment + poorrich + poliscale + citizenship + idenpa, 
                     selected)

outcome_model <- lm(tradebenefit ~ PC1 + foreignprodqual + sexo + edad + 
                      education + employment + poorrich + poliscale + 
                      citizenship + idenpa, selected)

mediation_result <- mediate(mediator_model, outcome_model, treat = 'PC1', 
                            mediator = 'foreignprodqual')

summary(mediation_result)

par(mar=c(5.1, 4.1, 3.1, 2.1))

plot(mediation_result, main = "Imported products", 
     xlab = "Effects on (General) Trade Support")
mtext("(No significant mediation effect)", side = 3, line = 0.1, cex = 0.75)


par(opar)
```

#### Figure 3. Estimated effect of corruption perceptions on trade support conditional on beliefs about progress of the home country (with 95% confidence intervals)

```{r}
Progressing <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + 
                    poorrich + poliscale + citizenship + idenpa, 
                  data[data$noprogress == 0, ])
Standstill <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + 
                   poorrich + poliscale + citizenship + idenpa, 
                 data[data$noprogress == 1, ])
In_Decline <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + 
                   poorrich + poliscale + citizenship + idenpa, 
                 data[data$noprogress == 2, ])
Pooled <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + 
               poorrich + poliscale + citizenship + idenpa, data)

get_coef_ci <- function(model, term) {
  est <- coef(model)[term]
  CI <- confint(model, level = 0.95)[term, ]
  return(c(est, CI[1], CI[2]))
}

progressing.coef <- get_coef_ci(Progressing, "PC1")
standstill.coef <- get_coef_ci(Standstill, "PC1")
in_decline.coef <- get_coef_ci(In_Decline, "PC1")
pooled.coef <- get_coef_ci(Pooled, "PC1")

plot_data <- data.frame(
  Model = c("Progressing", "Standstill", "In Decline", "Pooled"),
  Estimate = c(progressing.coef[1], standstill.coef[1], in_decline.coef[1], pooled.coef[1]),
  CI.Lower = c(progressing.coef[2], standstill.coef[2], in_decline.coef[2], pooled.coef[2]),
  CI.Upper = c(progressing.coef[3], standstill.coef[3], in_decline.coef[3], pooled.coef[3])
)

plot(1:4, plot_data$Estimate, 
     xlim = c(0.5, 4.5),
     ylim = range(c(plot_data$CI.Lower, plot_data$CI.Upper)),
     pch = 16, xaxt = "n", xlab = "", ylab = "Coef. of Corruption Perceptions (PC1)",
     main = "Effect of corruption perceptions on trade support")
axis(1, at = 1:4, labels = plot_data$Model)
arrows(1:4, plot_data$CI.Lower, 1:4, plot_data$CI.Upper, code = 0, angle = 90, 
       length = 0.05)

text(1:4, par("usr")[3] - 0.1, labels = plot_data$Model, srt = 45, adj = 1, xpd = TRUE)

abline(h = 0, lty = 2, col = "darkgrey")
```

#### Figure 4. Estimated effect of corruption perceptions on trade support conditional on beliefs about whether eradication of corruption is possible (with 95% confidence intervals)

```{r}
Eradication_Possible <- lm(tradebenefit ~ PC1 + sexo + edad + education + 
                             employment + poorrich + poliscale + citizenship + 
                             idenpa, data[data$eradicateimp == 0, ])
Eradication_Impossible <- lm(tradebenefit ~ PC1 + sexo + edad + education + 
                               employment + poorrich + poliscale + citizenship + 
                               idenpa, data[data$eradicateimp == 1, ])
Pooled <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + 
               poorrich + poliscale + citizenship + idenpa, data)

get_coef_ci <- function(model, term) {
  est <- coef(model)[term]
  CI <- confint(model, level = 0.95)[term, ]
  return(c(est, CI[1], CI[2]))
}

eradication_possible_coef <- get_coef_ci(Eradication_Possible, "PC1")
eradication_impossible_coef <- get_coef_ci(Eradication_Impossible, "PC1")
pooled_coef <- get_coef_ci(Pooled, "PC1")

plot_data <- data.frame(
  Model = c("Eradication Possible", "Eradication Impossible", "Pooled"),
  Estimate = c(eradication_possible_coef[1], eradication_impossible_coef[1], pooled_coef[1]),
  CI.Lower = c(eradication_possible_coef[2], eradication_impossible_coef[2], pooled_coef[2]),
  CI.Upper = c(eradication_possible_coef[3], eradication_impossible_coef[3], pooled_coef[3])
)

plot(1:3, plot_data$Estimate, 
     xlim = c(0.5, 3.5),
     ylim = range(c(plot_data$CI.Lower, plot_data$CI.Upper)),
     pch = 16, xaxt = "n", xlab = "", ylab = "Coef. of Corruption Perceptions (PC1)",
     main = "Effect of corruption perceptions on trade support")
axis(1, at = 1:3, labels = plot_data$Model)
arrows(1:3, plot_data$CI.Lower, 1:3, plot_data$CI.Upper, code = 0, angle = 90, 
       length = 0.05)

text(1:3, par("usr")[3] - 0.1, labels = plot_data$Model, srt = 45, adj = 1, xpd = TRUE)

abline(h = 0, lty = 2, col = "darkgrey")
```

#### Figure 5. Estimated effects of corruption perceptions on trade support from the main model and from models where dissatisfaction variables are added separately and then simultaneously (with 95% confidence intervals)

```{r}
Main_Model <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + 
                   poorrich + poliscale + citizenship + idenpa, data)
Main_Model_plus_Dissatisfaction_with_Democracy <- lm(tradebenefit ~ PC1 + sexo + 
                                                       edad + education + employment +
                                                       poorrich + poliscale + 
                                                       citizenship + idenpa + 
                                                       dissatdem, data)
Main_Model_plus_Dissatisfaction_with_Economy <- lm(tradebenefit ~ PC1 + sexo + 
                                                     edad + education + employment +
                                                     poorrich + poliscale + 
                                                     citizenship + idenpa + 
                                                     dissatecon, data)
Main_Model_plus_Dissatisfaction_with_Both <- lm(tradebenefit ~ PC1 + sexo + edad +
                                                  education + employment + 
                                                  poorrich + poliscale + 
                                                  citizenship + idenpa + 
                                                  dissatdem + dissatecon, data)

get_coef_ci <- function(model, term) {
  est <- coef(model)[term]
  CI <- confint(model, level = 0.95)[term, ]
  return(c(est, CI[1], CI[2]))
}

main_model.coef <- get_coef_ci(Main_Model, "PC1")
main_model_plus_dd.coef <- get_coef_ci(Main_Model_plus_Dissatisfaction_with_Democracy,
                                       "PC1")
main_model_plus_de.coef <- get_coef_ci(Main_Model_plus_Dissatisfaction_with_Economy,
                                       "PC1")
main_model_plus_both.coef <- get_coef_ci(Main_Model_plus_Dissatisfaction_with_Both, 
                                         "PC1")

plot_data <- data.frame(
  Model = c("Main Model", "+ Dissat. Dem.", "+ Dissat. Econ.", "+ Both Dissat."),
  Estimate = c(main_model.coef[1], main_model_plus_dd.coef[1], 
               main_model_plus_de.coef[1], main_model_plus_both.coef[1]),
  CI.Lower = c(main_model.coef[2], main_model_plus_dd.coef[2], 
               main_model_plus_de.coef[2], main_model_plus_both.coef[2]),
  CI.Upper = c(main_model.coef[3], main_model_plus_dd.coef[3], 
               main_model_plus_de.coef[3], main_model_plus_both.coef[3])
)

plot(1:4, plot_data$Estimate, 
     xlim = c(0.5, 4.5),
     ylim = range(c(-0.001, plot_data$CI.Upper)),
     pch = 16, xaxt = "n", xlab = "", ylab = "Coef. of Corruption Perceptions (PC1)",
     main = "Effect of corruption perceptions on trade support")
axis(1, at = 1:4, labels = plot_data$Model)
arrows(1:4, plot_data$CI.Lower, 1:4, plot_data$CI.Upper, code = 0, angle = 90, 
       length = 0.05)

text(1:4, par("usr")[3] - 0.1, labels = plot_data$Model, srt = 45, adj = 1, xpd = TRUE)

abline(h = 0, lty = 2, col = "darkgrey")
```

#### Figure 6. Model-based causal mediation analysis results (with 95% confidence intervals)

```{r}
# This chunk typically takes a few minutes to run

set.seed(12345)

opar <- par(no.readonly = TRUE)

par(mfrow = c(2, 2))


selected <- na.omit(dplyr::select(data, tradebenefit, PC1, usposinf, sexo, edad, 
                                  education, employment, poorrich, poliscale, 
                                  citizenship, idenpa, dissatdem, dissatecon))

mediator_model <- lm(usposinf ~ PC1 + sexo + edad + education + employment + 
                       poorrich + poliscale + citizenship + idenpa + dissatdem + 
                       dissatecon, selected)

outcome_model <- lm(tradebenefit ~ PC1 + usposinf + sexo + edad + education + 
                      employment + poorrich + poliscale + citizenship + idenpa + 
                      dissatdem + dissatecon, selected)

mediation_result <- mediate(mediator_model, outcome_model, treat = 'PC1', 
                            mediator = 'usposinf')

summary(mediation_result)

par(mar=c(5.1, 4.1, 3.1, 2.1))

plot(mediation_result, main = "Foreign nations", xlab = "Effects on Trade Support")
mtext("(Both dissat. vars added to model, Prop. Mediated = 0.13)", side = 3, 
      line = 0.1, cex = 0.75)


selected <- na.omit(dplyr::select(data, supportint, PC1, usposinf, sexo, edad, 
                                  education, employment, poorrich, poliscale, 
                                  citizenship, idenpa))

mediator_model <- lm(usposinf ~ PC1 + sexo + edad + education + employment + 
                       poorrich + poliscale + citizenship + idenpa, selected)

outcome_model <- lm(supportint ~ PC1 + usposinf + sexo + edad + education + 
                      employment + poorrich + poliscale + citizenship + idenpa,
                    selected)

mediation_result <- mediate(mediator_model, outcome_model, treat = 'PC1', 
                            mediator = 'usposinf')

summary(mediation_result)

par(mar=c(5.1, 4.1, 3.1, 2.1))

plot(mediation_result, main = "Foreign nations", 
     xlab = "Effects on Integration Support")
mtext("(Prop. Mediated = 0.07)", side = 3, line = 0.1, cex = 0.75)


par(opar)
```

### Results in supplementary information appendix

#### Figure A1. Density plots of trade support (left) and corruption perceptions (right, vertical line indicates the median) based on pooled data from survey respondents in eighteen Latin American countries

```{r, warning=F}
p1 <- ggplot(data, aes(x = tradebenefit, y = ..density..)) +
  geom_histogram(binwidth = 0.5, fill = "grey", color = "black") +
  theme_classic() +
  theme(axis.title.y = element_blank()) + labs(x = "Support for Free Trade", y = "")

median_PC1 <- median(data$PC1, na.rm = TRUE)

density_data <- density(data$PC1, na.rm = TRUE)

closest_point <- which.min(abs(density_data$x - median_PC1))
density_at_median <- density_data$y[closest_point]

p2 <- ggplot(data, aes(x = PC1)) +
  geom_density(
    fill = "grey", color = "black"
  ) +
  geom_segment(
    aes(x = median_PC1, xend = median_PC1, y = 0, yend = density_at_median),
    color = "black",
    linetype = "solid"
  ) +
  theme_classic() + 
  theme(axis.title.y = element_blank()) + 
  labs(x = "Corruption Perceptions (PC1)", y = "")

p1 + p2
```

#### Figure A2. Distributions of trade support (left) and corruption perceptions (right, vertical lines indicate medians), broken down by country

```{r, warning=F, message=F}
country_mapping <- data.frame(
  idenpa = c(32, 68, 76, 152, 170, 188, 214, 218, 222, 320, 340, 484, 558, 591, 
             600, 604, 858, 862),
  country_name = c("Argentina", "Bolivia", "Brazil", "Chile", "Colombia", 
                   "Costa Rica", "Rep. Dominicana", "Ecuador", "El Salvador", 
                   "Guatemala", "Honduras", "Mexico", "Nicaragua", "Panama", 
                   "Paraguay", "Peru", "Uruguay", "Venezuela")
)

data_with_countries <- merge(data, country_mapping, by = "idenpa")

data_with_countries$country_name <- factor(data_with_countries$country_name, 
  levels = country_mapping$country_name[order(country_mapping$idenpa)])

get_density_at_point <- function(data, point) {
  d <- density(data$tradebenefit, na.rm = TRUE)
  approx(d$x, d$y, xout = point)$y
}

medians <- data_with_countries %>%
  group_by(idenpa, country_name) %>%
  summarise(median_tradebenefit = median(tradebenefit, na.rm = TRUE),
            density_at_median = get_density_at_point(cur_data(), median_tradebenefit))

p1 <- ggplot(data_with_countries, aes(x = tradebenefit, y = ..density..)) +
  geom_histogram(binwidth = 0.5, fill = "grey", color = "black") +
  facet_grid(country_name ~ ., scales = "fixed", space = "fixed") +
  scale_y_continuous(expand = expansion(mult = c(0, 0), add = c(1, 0))) +
  theme_classic() +
  theme(
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        strip.background = element_blank(),
        strip.text.y = element_text(angle = 0),
        panel.spacing = unit(0, "lines")) + labs(x = "Support for Free Trade", y = "")


data_with_countries$country_name <- factor(data_with_countries$country_name, 
  levels = rev(levels(data_with_countries$country_name)))

get_density_at_point <- function(data, point) {
  d <- density(data$PC1, na.rm = TRUE)
  approx(d$x, d$y, xout = point)$y
}

medians <- data_with_countries %>%
  group_by(idenpa, country_name) %>%
  summarise(median_PC1 = median(PC1, na.rm = TRUE),
            density_at_median = get_density_at_point(cur_data(), median_PC1))

p2 <- ggplot(data_with_countries, aes(x = PC1, y = country_name)) +
  geom_density_ridges(scale = 0.9) +
  geom_segment(data = medians, aes(x = median_PC1, xend = median_PC1, 
                                 y = as.numeric(country_name), 
                                 yend = as.numeric(country_name) + 
                                   density_at_median / 2 + 0.05),
               fill = "grey", color = "black") +
  theme_classic() + theme(axis.title.y = element_blank(), axis.text.y = element_blank(),
                          axis.ticks.y = element_blank()) + 
  labs(x = "Corruption Perceptions (PC1)", y = "")

data_with_countries$country_name <- factor(data_with_countries$country_name, 
  levels = rev(levels(data_with_countries$country_name)))

p1 + p2
```

#### Figure A3. Correlational biplot indicating direction and degree of association between five input variables and their first two principal components

```{r}
selected <- na.omit(dplyr::select(data, numentre, presidente, parlamentarios,
                                  empleadospublicos, gobiernolocal, jueces))

colnames(selected) <- c("numentre", "President", "Members of Congress", 
                        "Public Employees", "Local Government Councilors", "Judges")

pca <- prcomp(selected[, -1])

fviz_pca_var(pca, col.var = "contrib", gradient.cols = "YlOrRd") +
  scale_x_continuous(limits = c(-0.42, 0)) + scale_y_continuous(limits = c(-0.42, 0.2))
```

#### Table B1. Models of support for free trade as a function of corruption perceptions and control covariates

```{r, warning=F}
data$tradebenefit <- as.numeric(data$tradebenefit)

m1 <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data)

data$tradebenefit <- ordered(data$tradebenefit)

m2 <- polr(tradebenefit ~ PC1 + sexo + edad + education + employment + poorrich +
             poliscale + citizenship + idenpa, data, Hess = T)

data$tradebenefit <- as.numeric(data$tradebenefit)

m3 <- lm(tradebenefit ~ cps + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data)

data$tradebenefit <- ordered(data$tradebenefit)

m4 <- polr(tradebenefit ~ cps + sexo + edad + education + employment + poorrich +
             poliscale + citizenship + idenpa, data, Hess = T)

data$tradebenefit <- as.numeric(data$tradebenefit)

stargazer::stargazer(m1, m2, m3, m4,
                     type = 'text', # Change to 'latex' for LaTeX output
                     dep.var.labels = 'Support for Free Trade',
                     omit = c('idenpa', 'Constant'),
                     omit.stat = c('f', 'ser', 'adj.rsq', "rsq"),
                     covariate.labels = c('Corruption perceptions (PC1)', 
                                          'Corruption perceptions (additive)', 
                                          'Female', 'Age', 'Education', 
                                          'Employed in a state company', 
                                          'Employed in a private company', 
                                          'Not employed', 'Wealth', 
                                          'Political ideology', 'Not a citizen'),
                     align = T,
                     no.space = F,
                     single.row = F,
                     notes = 
                       "Country fixed effects included. Standard errors in parentheses"
)
```

#### Table B2. Models of support for free trade as a function of separate indicators of corruption by different political elites or as a function of perceptions of national and local level corruption, plus control covariates

```{r, warning=F}
data$tradebenefit <- as.numeric(data$tradebenefit)

m1 <- lm(tradebenefit ~ presidente + sexo + edad + education + employment + 
           poorrich + poliscale + citizenship + idenpa, data)

m2 <- lm(tradebenefit ~ parlamentarios + sexo + edad + education + employment + 
           poorrich + poliscale + citizenship + idenpa, data)

m3 <- lm(tradebenefit ~ empleadospublicos + sexo + edad + education + employment + 
           poorrich + poliscale + citizenship + idenpa, data)

m4 <- lm(tradebenefit ~ gobiernolocal + sexo + edad + education + employment + 
           poorrich + poliscale + citizenship + idenpa, data)

m5 <- lm(tradebenefit ~ jueces + sexo + edad + education + employment + 
           poorrich + poliscale + citizenship + idenpa, data)

m6 <- lm(tradebenefit ~ sinacionalsilocal + sinacionalnolocal + nonacionalsilocal +
           sexo + edad + education + employment + poorrich + poliscale + 
           citizenship + idenpa, data)

stargazer::stargazer(m1, m2, m3, m4, m5, m6,
                     type = 'text', # Change to 'latex' for LaTeX output
                     dep.var.labels = 'Support for Free Trade',
                     omit = c('idenpa', 'Constant'),
                     omit.stat = c('f', 'ser', 'adj.rsq', "rsq"),
                     covariate.labels = c('President', 'Members of Congress', 
                                          'Public employees', 
                                          'Local government councilors', 'Judges', 
                                          'Both national and local level', 
                                          'Only national level corruption',
                                          'Only local level corruption', 'Female', 
                                          'Age', 'Education',
                                          'Employed in a state company', 
                                          'Employed in a private company', 
                                          'Not employed', 'Wealth',
                                          'Political ideology', 'Not a citizen'),
                     align = T,
                     no.space = F,
                     single.row = F,
                     notes = 
                       "Country fixed effects included. Standard errors in parentheses"
)
```

#### Figure B1. Completely-unpooled country-specific effects of corruption perceptions on trade support (with 95% confidence intervals)

```{r}
country_mapping <- data.frame(
  idenpa = c(32, 68, 76, 152, 170, 188, 214, 218, 222, 320, 340, 484, 558, 591, 
             600, 604, 858, 862),
  country_name = c("Argentina", "Bolivia", "Brazil", "Chile", "Colombia", 
                   "Costa Rica", "Rep. Dominicana", "Ecuador", "El Salvador", 
                   "Guatemala", "Honduras", "Mexico", "Nicaragua", "Panama", 
                   "Paraguay", "Peru", "Uruguay", "Venezuela")
)

models <- list()
PC1_coefficients <- numeric(length(country_mapping$idenpa))
PC1_confint <- matrix(0, nrow = length(country_mapping$idenpa), ncol = 2)

for (i in 1:nrow(country_mapping)) {
  country_id <- country_mapping$idenpa[i]
  models[[paste0("model", country_id)]] <- 
    lm(tradebenefit ~ PC1 + sexo + edad + education + employment + poorrich + 
         poliscale + citizenship, data[data$idenpa == country_id, ])
  
  model <- models[[paste0("model", country_id)]]
  PC1_coefficients[i] <- coef(model)["PC1"]
  PC1_confint[i, ] <- confint(model)["PC1", ]
}

sort_idx <- order(PC1_coefficients, decreasing = TRUE)
sorted_coefficients <- PC1_coefficients[sort_idx]
sorted_confint <- PC1_confint[sort_idx, ]
sorted_countries <- country_mapping$country_name[sort_idx]

par(mar = c(8.1, 4.1, 4.1, 2.1))

plot(sorted_coefficients, ylim = range(c(sorted_confint)), type = "n", 
     main = "Effect of corruption perceptions on trade support", xlab = "", 
     ylab = "Coef. of Corruption Perceptions (PC1)", xaxt = "n")

axis(1, at = 1:length(sorted_countries), labels = sorted_countries, las = 2) 

points(sorted_coefficients, pch = 16)
arrows(1:length(sorted_countries), sorted_confint[, 1], 1:length(sorted_countries), 
       sorted_confint[, 2], angle = 90, code = 0, length = 0.05)

abline(h = 0, lty = 2, col = "darkgrey")
```

#### Table C1. Models of perceptions of the US, support for trade with the US, perceptions of international companies, and perceptions of imported product quality as a function of corruption perceptions and control covariates

```{r, warning=F}
m1 <- lm(usposinf ~ PC1 + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data)

m2 <- lm(protradeus ~ PC1 + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data)

m3 <- lm(trustforeigncomp ~ PC1 + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data)

m4 <- lm(foreignprodqual ~ PC1 + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data)

stargazer::stargazer(m1, m2, m3, m4,
                     type = 'text', # Change to 'latex' for LaTeX output
                     dep.var.labels = c('Percept. US', 'Support Trade w/ US', 
                                        'Percept. Int\'l Companies', 
                                        'Percept. Import Quality'),
                     omit = c('idenpa', 'Constant'),
                     omit.stat = c('f', 'ser', 'adj.rsq', "rsq"),
                     covariate.labels = c('Corruption perceptions (PC1)', 
                                          'Female', 'Age', 'Education', 
                                          'Employed in a state company', 
                                          'Employed in a private company', 
                                          'Not employed', 'Wealth', 
                                          'Political ideology', 'Not a citizen'),
                     align = T,
                     no.space = F,
                     single.row = F,
                     notes = 
                       "Country fixed effects included. Standard errors in parentheses"
)
```

#### Figure C1. Predicted values of mediators and support for trade with the US as a function of corruption perceptions (with 95% confidence envelopes)

```{r}
mediator_model <- lm(usposinf ~ PC1 + sexo + edad + education + employment + 
                       poorrich + poliscale + citizenship + idenpa, data)

new_data <- data.frame(
  PC1 = seq(min(data$PC1, na.rm = TRUE), max(data$PC1, na.rm = TRUE), length.out=100),
  sexo = median(data$sexo, na.rm = TRUE),
  edad = median(data$edad, na.rm = TRUE),
  education = median(data$education, na.rm = TRUE),
  employment = as.factor(0),
  poorrich = median(data$poorrich, na.rm = TRUE),
  poliscale = median(data$poliscale, na.rm = TRUE),
  citizenship = median(data$citizenship, na.rm = TRUE),
  idenpa = as.factor(32)
)

pred_probs <- ggeffect(mediator_model, terms = "PC1", type = "response", 
                       data = new_data, ci_level = 0.95)

pred_probs_df <- as.data.frame(pred_probs)

p1 <- ggplot() +
  geom_rug(data = data.frame(PC1 = jitter(data$PC1, factor = 2)), aes(x = PC1),
           sides = "b", size = 0.01) + 
  geom_line(data = pred_probs_df, aes(x = x, y = predicted)) +
  geom_ribbon(data = pred_probs_df, aes(x = x, ymin = conf.low, ymax = conf.high), 
              alpha = 0.2) +
  xlab('Corruption Perceptions (PC1)') +
  ylab('Predicted Perceptions of the US') +
  ggtitle('Perceptions of the US are\npredicted to be more positive at\nhigher levels of perceived corruption') +
  theme_classic() +
  scale_y_continuous(breaks = seq(0.6, 0.8, by = 0.015), labels = label_number()) + 
  scale_x_continuous(breaks = seq(-1.2, 1.2, by = 0.3), labels = label_number())


fit_linear <- lm(protradeus ~ PC1 + sexo + edad + education + employment + 
                   poorrich + poliscale + citizenship + idenpa, data = data)

pred_probs <- ggeffect(fit_linear, terms = "PC1", type = "response", 
                       data = new_data, ci_level = 0.95)

pred_probs_df <- as.data.frame(pred_probs)

p2 <- ggplot() +
  geom_rug(data = data.frame(PC1 = jitter(data$PC1, factor = 2)), aes(x = PC1), 
           sides = "b", size = 0.01) + 
  geom_line(data = pred_probs_df, aes(x = x, y = predicted)) +
  geom_ribbon(data = pred_probs_df, aes(x = x, ymin = conf.low, ymax = conf.high), 
              alpha = 0.2) +
  xlab('Corruption Perceptions (PC1)') +
  ylab('Predicted Support for Trade with the US') +
  ggtitle('Support for trade with the US is\npredicted to be greater at\nhigher levels of perceived corruption') +
  theme_classic() +
  scale_y_continuous(breaks = seq(1.8, 2.2, by = 0.025), labels = label_number()) + 
  scale_x_continuous(breaks = seq(-1.2, 1.2, by = 0.3), labels = label_number())


mediator_model <- lm(trustforeigncomp ~ PC1 + sexo + edad + education + employment + 
                       poorrich + poliscale + citizenship + idenpa, data)

pred_probs <- ggeffect(mediator_model, terms = "PC1", type = "response", 
                       data = new_data, ci_level = 0.95)

pred_probs_df <- as.data.frame(pred_probs)

p3 <- ggplot() +
  geom_rug(data = data.frame(PC1 = jitter(data$PC1, factor = 2)), aes(x = PC1), 
           sides = "b", size = 0.01) + 
  geom_line(data = pred_probs_df, aes(x = x, y = predicted)) +
  geom_ribbon(data = pred_probs_df, aes(x = x, ymin = conf.low, ymax = conf.high), 
              alpha = 0.2) +
  xlab('Corruption Perceptions (PC1)') +
  ylab('Predicted Perceptions of International Companies') +
  ggtitle('Perceptions of int\'l companies are\npredicted to be more positive at\nhigher levels of perceived corruption') +
  theme_classic() +
  scale_y_continuous(breaks = seq(2.8, 3, by = 0.03), labels = label_number()) + 
  scale_x_continuous(breaks = seq(-1.2, 1.2, by = 0.3), labels = label_number())


mediator_model <- lm(foreignprodqual ~ PC1 + sexo + edad + education + employment + 
                       poorrich + poliscale + citizenship + idenpa, data)

pred_probs <- ggeffect(mediator_model, terms = "PC1", type = "response", 
                       data = new_data, ci_level = 0.95)

pred_probs_df <- as.data.frame(pred_probs)

p4 <- ggplot() +
  geom_rug(data = data.frame(PC1 = jitter(data$PC1, factor = 2)), aes(x = PC1), 
           sides = "b", size = 0.01) + 
  geom_line(data = pred_probs_df, aes(x = x, y = predicted)) +
  geom_ribbon(data = pred_probs_df, aes(x = x, ymin = conf.low, ymax = conf.high), 
              alpha = 0.2) +
  xlab('Corruption Perceptions (PC1)') +
  ylab('Predicted Perceptions of Imported Product Quality') +
  ggtitle('Effect of corruption perceptions\non perceptions of import quality\nis not statistically significant') +
  theme_classic() +
  # scale_y_continuous(breaks = seq(2.8, 3, by = 0.03), labels = label_number()) + 
  scale_x_continuous(breaks = seq(-1.2, 1.2, by = 0.3), labels = label_number())


p1 + p2
p3 + p4
```

#### Table C2. Models of support for free trade as a function of corruption perceptions and control covariates, conditional on beliefs about progress of the home country

```{r, warning=F}
m1 <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data[data$noprogress == 0, ])
m2 <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data[data$noprogress == 1, ])
m3 <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data[data$noprogress == 2, ])
m4 <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data)

stargazer::stargazer(m1, m2, m3, m4,
                     type = 'text', # Change to 'latex' for LaTeX output
                     dep.var.labels = c('Support for Free Trade'),
                     omit = c('idenpa', 'Constant'),
                     omit.stat = c('f', 'ser', 'adj.rsq', "rsq"),
                     covariate.labels = c('Corruption perceptions (PC1)', 
                                          'Female', 'Age', 'Education', 
                                          'Employed in a state company', 
                                          'Employed in a private company', 
                                          'Not employed', 'Wealth', 
                                          'Political ideology', 'Not a citizen'),
                     align = T,
                     no.space = F,
                     single.row = F,
                     notes =
                       "Country fixed effects included. Standard errors in parentheses"
)
```

#### Figure C2. Additional model-based causal mediation analysis results (with 95% confidence intervals)

```{r}
# This chunk typically takes a few minutes to run

set.seed(12345)

selected <- na.omit(dplyr::select(data, tradebenefit, PC1, trustforeigncomp, 
                                  sexo, edad, education, employment, poorrich, 
                                  poliscale, citizenship, idenpa, distrustfb))

mediator_model <- lm(trustforeigncomp ~ PC1 + sexo + edad + education + 
                       employment + poorrich + poliscale + citizenship + idenpa + 
                       distrustfb, selected)

outcome_model <- lm(tradebenefit ~ PC1 + trustforeigncomp + sexo + edad + 
                      education + employment + poorrich + poliscale + citizenship + 
                      idenpa + distrustfb, selected)

mediation_result <- mediate(mediator_model, outcome_model, treat = 'PC1', 
                            mediator = 'trustforeigncomp')

summary(mediation_result)

par(mar=c(5.1, 4.1, 3.1, 2.1))

plot(mediation_result, main = "International Companies", 
     xlab = "Effects on Trade Support")
mtext("(\"Trust in big firms\" added to model, Prop. Mediated = 0.03)", side = 3, 
      line = 0.1, cex = 0.75)


mediator_model <- lm(trustforeigncomp ~ PC1 + sexo + edad + education + 
                       employment + poorrich + poliscale + citizenship + idenpa + 
                       distrustfb, selected)

outcome_model <- lm(tradebenefit ~ PC1 + trustforeigncomp * distrustfb + sexo + 
                      edad + education + employment + poorrich + poliscale + 
                      citizenship + idenpa, selected)

mediation_result <- mediate(mediator_model, outcome_model, treat = 'PC1', 
                            mediator = 'trustforeigncomp')

summary(mediation_result)

par(mar=c(5.1, 4.1, 3.1, 2.1))

plot(mediation_result, main = "International Companies", 
     xlab = "Effects on Trade Support")
mtext("(\"Trust in big firms\" and its interaction with mediator added to model, Prop. Mediated = 0.03)", 
      side = 3, line = 0.1, cex = 0.75)
```

#### Table D1. Models of support for free trade as a function of corruption perceptions and control covariates, conditional on beliefs about whether eradication of corruption is possible

```{r, warning=F}
m1 <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data[data$eradicateimp == 0, ])
m2 <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data[data$eradicateimp == 1, ])
m3 <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data)

stargazer::stargazer(m1, m2, m3,
                     type = 'text', # Change to 'latex' for LaTeX output
                     dep.var.labels = c('Support for Free Trade'),
                     omit = c('idenpa', 'Constant'),
                     omit.stat = c('f', 'ser', 'adj.rsq', "rsq"),
                     covariate.labels = c('Corruption perceptions (PC1)', 
                                          'Female', 'Age', 'Education', 
                                          'Employed in a state company', 
                                          'Employed in a private company', 
                                          'Not employed', 'Wealth', 
                                          'Political ideology', 'Not a citizen'),
                     align = T,
                     no.space = F,
                     single.row = F,
                     notes = 
                       "Country fixed effects included. Standard errors in parentheses"
)
```

#### Table D2. Models of support for free trade as a function of corruption perceptions and control covariates, with and without dissatisfaction variables added

```{r, warning=F}
m1 <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data)
m2 <- lm(tradebenefit ~ PC1 + dissatdem + sexo + edad + education + employment + 
           poorrich + poliscale + citizenship + idenpa, data)
m3 <- lm(tradebenefit ~ PC1 + dissatecon + sexo + edad + education + employment + 
           poorrich + poliscale + citizenship + idenpa, data)
m4 <- lm(tradebenefit ~ PC1 + dissatdem + dissatecon + sexo + edad + education + 
           employment + poorrich + poliscale + citizenship + idenpa, data)

stargazer::stargazer(m1, m2, m3, m4,
                     type = 'text', # Change to 'latex' for LaTeX output
                     dep.var.labels = c('Support for Free Trade'),
                     omit = c('idenpa', 'Constant'),
                     omit.stat = c('f', 'ser', 'adj.rsq', "rsq"),
                     covariate.labels = c('Corruption perceptions (PC1)', 
                                          'Dissatisfied w/ democracy', 
                                          'Dissatisfied w/ economy', 
                                          'Female', 'Age', 'Education', 
                                          'Employed in a state company', 
                                          'Employed in a private company', 
                                          'Not employed', 'Wealth', 
                                          'Political ideology', 'Not a citizen'),
                     align = T,
                     no.space = F,
                     single.row = F,
                     notes = 
                       "Country fixed effects included. Standard errors in parentheses"
)
```

#### Table D3. Models of support for free trade and support for international integration as a function of corruption perceptions and control covariates

```{r, warning=F}
m1 <- lm(tradebenefit ~ PC1 + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data)
m2 <- lm(supportint ~ PC1 + sexo + edad + education + employment + poorrich + 
           poliscale + citizenship + idenpa, data)

stargazer::stargazer(m1, m2,
                     type = 'text', # Change to 'latex' for LaTeX output
                     dep.var.labels = c('Support for Free Trade', 
                                        'Support for International Integration'),
                     omit = c('idenpa', 'Constant'),
                     omit.stat = c('f', 'ser', 'adj.rsq', "rsq"),
                     covariate.labels = c('Corruption perceptions (PC1)', 
                                          'Female', 'Age', 'Education', 
                                          'Employed in a state company', 
                                          'Employed in a private company', 
                                          'Not employed', 'Wealth', 
                                          'Political ideology', 'Not a citizen'),
                     align = T,
                     no.space = F,
                     single.row = F,
                     notes = 
                       "Country fixed effects included. Standard errors in parentheses"
)
```

#### Figure D1. Predicted values of support for international integration as a function of corruption perceptions (with 95% confidence envelopes)

```{r}
fit_linear <- lm(supportint ~ PC1 + sexo + edad + education + employment + 
                   poorrich + poliscale + citizenship + idenpa, data = data)

new_data <- data.frame(
  PC1 = seq(min(data$PC1, na.rm = TRUE), max(data$PC1, na.rm = TRUE), length.out=100),
  sexo = median(data$sexo, na.rm = TRUE),
  edad = median(data$edad, na.rm = TRUE),
  education = median(data$education, na.rm = TRUE),
  employment = as.factor(0),
  poorrich = median(data$poorrich, na.rm = TRUE),
  poliscale = median(data$poliscale, na.rm = TRUE),
  citizenship = median(data$citizenship, na.rm = TRUE),
  idenpa = as.factor(32)
)

pred_probs <- ggeffect(fit_linear, terms = "PC1", type = "response", 
                       data = new_data, ci_level = 0.95)

pred_probs_df <- as.data.frame(pred_probs)

ggplot() +
  geom_rug(data = data.frame(PC1 = jitter(data$PC1, factor = 2)), aes(x = PC1), 
           sides = "b", size = 0.01) + 
  geom_line(data = pred_probs_df, aes(x = x, y = predicted)) +
  geom_ribbon(data = pred_probs_df, aes(x = x, ymin = conf.low, ymax = conf.high), 
              alpha = 0.2) +
  xlab('Corruption Perceptions (PC1)') +
  ylab('Predicted Support for International Integration') +
  ggtitle('Integration support is predicted to be greater at higher levels of perceived corruption') +
  theme_classic() +
  scale_y_continuous(labels = label_number()) + 
  scale_x_continuous(breaks = seq(-1.2, 1.2, by = 0.3), labels = label_number())
```


## Analyses using Pew 2018 data

### Data preparation

```{r, warning=F, message=F}
rm(list = ls())

data <- read_csv("Data/Pew Research Global Attitudes Spring 2018 Dataset WEB FINAL.csv")

data$tradegood <- ifelse(data$trade < 8, 4 - data$trade, NA)
data$corrupt <- ifelse(data$describecountry_corrupt < 8, 4 - data$describecountry_corrupt, NA)
data$sex <- data$sex - 1
data$age <- ifelse(data$age < 98, data$age, NA)

data$developed <- ifelse(data$COUNTRY %in% 
                    c(2, 4, 5, 6, 7, 11, 12, 13, 16, 22, 23, 24, 26, 27), 1, 0)
data$COUNTRY <- as.factor(data$COUNTRY)

WDI <- read_csv("Data/WDI_2017.csv")
```

### Results in main text

#### Figure 7. Effect of corruption perceptions on trade support conditional on IMF’s classification of developing and developed economies (with 95% confidence intervals)

```{r}
pooled <- lm(tradegood ~ corrupt + sex + age + COUNTRY, data)
developed <- lm(tradegood ~ corrupt + sex + age + COUNTRY, data[data$developed == 1, ])
developing <- lm(tradegood ~ corrupt + sex + age + COUNTRY, data[data$developed == 0, ])

get_coef_ci <- function(model, term) {
  est <- coef(model)[term]
  CI <- confint(model, level = 0.95)[term, ]
  return(c(est, CI[1], CI[2]))
}

pooled.coef <- get_coef_ci(pooled, "corrupt")
developed.coef <- get_coef_ci(developed, "corrupt")
developing.coef <- get_coef_ci(developing, "corrupt")

plot_data <- data.frame(
  Model = c("Developing Economies", "Developed Economies", "Pooled"),
  Estimate = c(developing.coef[1], developed.coef[1], pooled.coef[1]),
  CI.Lower = c(developing.coef[2], developed.coef[2], pooled.coef[2]),
  CI.Upper = c(developing.coef[3], developed.coef[3], pooled.coef[3])
)

plot(1:3, plot_data$Estimate, 
     xlim = c(0.5, 3.5),
     ylim = range(c(plot_data$CI.Lower, plot_data$CI.Upper)),
     pch = 16, xaxt = "n", xlab = "", ylab = "Coef. of Corruption Perceptions",
     main = "Effect of corruption perceptions on trade support")
axis(1, at = 1:3, labels = plot_data$Model)
arrows(1:3, plot_data$CI.Lower, 1:3, plot_data$CI.Upper, code = 0, angle = 90, 
       length = 0.05)

text(1:3, par("usr")[3] - 0.1, labels = plot_data$Model, srt = 45, adj = 1, xpd = TRUE)

abline(h = 0, lty = 2, col = "darkgrey")
```

#### Figure 8. Completely-unpooled country-specific effects of corruption perceptions on trade support (with 95% confidence intervals)

```{r}
models <- list()

for (i in 1:27) {
  models[[paste0("model", i)]] <- lm(tradegood ~ corrupt + sex + age, 
                                     data[data$COUNTRY == i, ])
}

corrupt_coefficients <- numeric(27)
corrupt_confint <- matrix(0, nrow = 27, ncol = 2)

for (i in 1:27) {
  model <- models[[paste0("model", i)]]
  corrupt_coefficients[i] <- coef(model)["corrupt"]
  corrupt_confint[i, ] <- confint(model)["corrupt",]
}

countries <- c("Argentina", "Australia", "Brazil", "Canada", "France", "Germany", 
               "Greece", "Hungary", "India", "Indonesia", "Israel", "Italy", 
               "Japan", "Kenya", "Mexico", "Netherlands", "Nigeria", "Philippines", 
               "Poland", "Russia", "South Africa", "South Korea", "Spain", 
               "Sweden", "Tunisia", "United Kingdom", "United States")

sort_idx <- order(corrupt_coefficients, decreasing = TRUE)
sorted_coefficients <- corrupt_coefficients[sort_idx]
sorted_confint <- corrupt_confint[sort_idx, ]
sorted_countries <- countries[sort_idx]

par(mar=c(7.1, 4.1, 4.1, 2.1))

plot(sorted_coefficients, ylim = range(c(sorted_confint)), type = "n", main = "Effect of corruption perceptions on trade support", xlab = "", ylab = "Coef. of Corruption Perceptions", xaxt = "n")

axis(1, at = 1:27, labels = sorted_countries, las = 2) 

points(sorted_coefficients, pch = 16)
arrows(1:27, sorted_confint[, 1], 1:27, sorted_confint[, 2], angle = 90, code = 0, length = 0.05)

abline(h = 0, lty = 2, col = "darkgrey")
```

#### Figure 9. Added-variable plot of the partial estimated effect of per capita GDP (log scale) on country-specific corruption perception coefficients (with 95% confidence intervals)

```{r}
models <- list()

for (i in 1:27) {
  models[[paste0("model", i)]] <- lm(tradegood ~ corrupt + sex + age, 
                                     data[data$COUNTRY == i, ])
}

corrupt_coefficients <- sapply(models, function(model) coef(model)["corrupt"])

country_level <- data.frame(WDI, corrupt_coefficients)

reduced_model_x <- lm(log(GDPpc) ~ Trade, data = country_level)
reduced_model_y <- lm(corrupt_coefficients ~ Trade, data = country_level)

resid_x <- residuals(reduced_model_x)
resid_y <- residuals(reduced_model_y)

fit_av <- lm(resid_y ~ resid_x)

conf_int_av <- predict(fit_av, interval = "confidence", 
                       newdata = data.frame(resid_x = resid_x))

av_plot_data <- data.frame(
  resid_x = resid_x,
  resid_y = resid_y,
  lower = conf_int_av[, "lwr"],
  upper = conf_int_av[, "upr"]
)

ggplot(av_plot_data, aes(x = resid_x, y = resid_y)) +
  geom_point(color = "darkgrey") +
  geom_line(aes(y = fit_av$fitted.values), color = "black") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "darkgrey") + 
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2) +
  labs(x = "Log(GDP per capita) | others", y = "Coef. of Corruption Perceptions | others",
       title = "Effect of corruption perceptions decreases as per capita GDP increases") +
  theme_classic() + geom_rug(sides = "b")
```

### Results in supplementary information appendix

#### Table E1. Models of support for free trade as a function of corruption perceptions and control covariates, conditional on IMF’s classification of developing and developed economies

```{r, warning=F}
m1 <- lm(tradegood ~ corrupt + sex + age + COUNTRY, data[data$developed == 0, ])
m2 <- lm(tradegood ~ corrupt + sex + age + COUNTRY, data[data$developed == 1, ])
m3 <- lm(tradegood ~ corrupt + sex + age + COUNTRY, data)

stargazer::stargazer(m1, m2, m3,
                     type = 'text', # Change to 'latex' for LaTeX output
                     dep.var.labels = 'Support for Free Trade',
                     omit = c('COUNTRY', 'Constant'),
                     omit.stat = c('f', 'ser', 'adj.rsq', "rsq"),
                     covariate.labels = c('Corruption perceptions', 'Female', 'Age'),
                     align = T,
                     no.space = F,
                     single.row = F,
                     notes = 
                       "Country fixed effects included. Standard errors in parentheses"
)
```

#### Table E2. Model of country-specific corruption perception coefficients as a function of per capita GDP (log scale) and trade dependency

```{r, warning=F}
models <- list()

for (i in 1:27) {
  models[[paste0("model", i)]] <- lm(tradegood ~ corrupt + sex + age, 
                                     data[data$COUNTRY == i, ])
}

corrupt_coefficients <- sapply(models, function(model) coef(model)["corrupt"])

country_level <- data.frame(WDI, corrupt_coefficients)

model <- lm(corrupt_coefficients ~ log(GDPpc) + Trade, data = country_level)

stargazer::stargazer(model,
                     type = 'text', # Change to 'latex' for LaTeX output
                     dep.var.labels = 'Coefficients of Corruption Perceptions',
                     omit = c('Constant'),
                     omit.stat = c('f', 'ser', 'adj.rsq', "rsq"),
                     covariate.labels = c('Log(GDP per capita)', 'Trade-to-GDP ratio'),
                     align = T,
                     no.space = F,
                     single.row = F,
                     notes = "Standard errors in parentheses"
)
```